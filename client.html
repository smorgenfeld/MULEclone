<html>
  <head>
    <title>mule yay</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src = "http://cdn.peerjs.com/0.3/peer.min.js"></script>
    <script src = "resources/dataupdate.js"></script>
    <script src = "resources/gamerender.js"></script>
  </head>
  <body>
    <form method="POST">
      server id: <input type="text" id = "connectin"><br>
      username: <input type="text" id = "username" value="client"><br>
      <button type="button" onclick="return connect()">Connect</button>
    </form>
    <textarea id="console" disabled rows=20 cols=40></textarea><br><br>
    Ready?
    <input type="checkbox" onclick="return readyup()" id="readybox"></input>
    <canvas id = "game" width="0" height = "0"></canvas>
    <script>
      var ready = false;
      $(document).ready(function() {
        peer = new Peer({key:'rpxx8uu3r2ju4n29', metadata: username, debug: 0});
        peer.on('open', function(id) {
          console.log("id is " + id);
          peer.on('connection', function(connn) {
          });
        });
      });
      function connect() {
        username = document.getElementById("username").value;
        peer.metadata = username;
        var connectid = document.getElementById("connectin").value;
        if (connectid != null) {
          conn = peer.connect(connectid);
          conn.on('open', function() {
            console.log("connected to " + conn.metadata);
            sendmessage(peer.metadata + " joined the game!");
            conn.on('data', function(data) {
              console.log('data',data);
              if (data.chat != null) {
                document.getElementById("console").value += data.chat;
              }
              if (data.ready == true) {
                startrender();
              }
            });
          });
        }
        return false;
      }
      function readyup() {
        var out = new dataupdate();

        if (!ready) {
          ready = true;
          out.addToChat(peer.metadata + " is ready!");
        }
        else {
          ready = false;
          out.addToChat(peer.metadata + " is not ready.");
        }
        out.ready = ready;
        conn.send(out.sendJSON());
      }
      function sendmessage(string) {
        var message = new dataupdate();
        message.addToChat(string);
        conn.send(message.sendJSON());
      }
      function randint(min, max) {
  			min = Math.ceil(min);
  			max = Math.floor(max);
  			return Math.floor(Math.random() * (max - min + 1)) + min;
			}
    </script>
  </body>
</html>
